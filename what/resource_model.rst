 .. resource_model .
 
---------
资源模型
---------

计算资源池是致云云管理平台部署、实施以及提供云服务的核心，本章节着重介绍致云云管理平台资源模型，涉及计算资源池各种功能特性和使用模式。


计算资源池
==========

致云云管理平台中的计算资源池，有两重含义：*虚拟资源集合* 以及 *业务特性模板* 。

    **虚拟资源集合**
        致云云管理平台允许将多个计算节点划分为一个计算资源池，各计算节点的计算、存储、网络资源都虚拟化到池中作为可用资源。用户创建云主机时，必须指定承载计算资源池，由管理平台在资源池内根据 **各节点实时负载加权计算** 选择合适的计算节点创建云主机实例。计算资源池的设计，极大地简化了整个云计算管理模型，用户无需关注要选择哪个节点承载实例，只需要指定计算资源池即可。
        
        管理员可以通过划分多个计算资源池，实现不同业务云主机的物理隔离。当资源池可用资源不足时，可以通过在线添加计算节点的方式，在不中断服务的情况下扩展可用资源。当计算资源池开启高可用模式时，当单一计算节点故障时，平台会将云主机实例自动迁移到同一资源池内的其他节点恢复服务。
        
        ..  image:: images/11_1_compute_pool_overview.png
        


    **业务特性模板**
        致云云管理平台的计算资源池模型，提供了网络模式、存储模式、Thin Provisioning等业务特性的设置(请详见云主机章节)，当用户基于计算资源池申请云主机时，只需要设置最基本的CPU数量、内存大小、磁盘空间、系统镜像、带宽信息，一键提交，其他的网络地址、存储模式都会根据目标计算资源池设置好的特性，自动分配并组装。无论是公有云运营还是私有云部署，特别是在批量部署的场景下，能大幅度提升云主机的部署速度。用户还可以利用不同资源池设置不同的业务属性，实现不同业务云主机的快速批量部署，如下图：
           
        ..  image:: images/11_2_compute_pool_template.png

        计算资源池A设置了使用独享IP池和共享存储，则从该计算池创建的云主机均会从独享IP池申请公网IP，并且将磁盘文件存储在指定的共享存储池；而计算资源池创建的出来的云主机，则只会直连模式接入网络，并且使用计算节点本地磁盘存储镜像文件。
        
        

**动态资源均衡**

致云云管理平台的计算资源池采用各节点实时负载，加权计算的方式选择承载节点，能够在保障系统最大可用性的条件下，最大程度地提高系统资源利用率。工作流程如下图所示：

    ..  image:: images/11_3_compute_pool_workflow.png

    1.  资源池所属计算节点实时地将当前CPU、内存、磁盘、网络的负载情况通知到主控节点(*Control Server*)中，主控节点在内存中实时更新最新状态
    #.  用户发起创建云主机请求并制定计算资源池
    #.  主控节点接受请求后，根据当前各计算节点负载情况，综合CPU、内存、磁盘等负载，加权计算目前资源池内负载最低的节点，作为承载节点
    #.  向计算池关联的地址池申请IP
    #.  向承载计算节点(*Node Client*)创建云主机实例
    #.  向智能路由(*Intelligent Router*)添加转发器
    #.  云主机组装完成，向请求用户返回成功
    
    ``以上流程仅用于展示典型工作流程，实际工作流程可能根据计算资源池设置模式不同而有差异，详情请查看相关章节``
    

地址资源池
==========

致云云管理平台提供了地址池来简化对IP地址和端口的管理和维护，地址池内存储了多个可用IP或者端口范围，地址池管理和记录地址资源的分配、使用状态；创建云主机时，由计算资源池向地址池申请可用地址；回收云主机时，将地址返回到池中，以便重新分配给其他云主机。

同一系统中，允许创建多个地址池，每个计算资源池允许关联一个地址池，池内创建云主机时，均向该地址池内申请资源。当管理员设置好计算资源池与地址池的关联关系之后，所有的地址申请、组装、释放均由系统自动控制完成，无需用户干预，极大地降低了管理难度。

地址池分为两种： *独享地址池* 和 *共享端口池*。
    
    *独享地址池* 能存放多个IP地址段，通常用于为云主机分配公网独享IP的场景，请求者可以从中申请独立的公网IP，并关联到云主机、VPC或者其他云服务上，实现弹性IP(Elastic IP)效果。
    
    *共享端口池* 能存放多个IP端口段，请求者可以从中申请的公网端口，通过Port Forwarding转发到目标云主机端口，通常用于为多个云主机共享一个公网IP的场景。
    
    地址资源池使用如下图所示：
    
    ..  image:: images/12_address_pool.png
        


镜像
====

致云云管理平台提供两种镜像模型：*ISO镜像* 和 *主机镜像*。

*ISO镜像* 主要是各种操作系统的初始安装光盘镜像，主要在平台部署初期，加载到空白云主机中，安装各种操作系统。当初始云主机安装好操作系统之后，就可以基于该云主机预装各种需要的应用系统，并制作成 *主机镜像* ，后续就可以通过主机镜像快速大量复制云主机实例，节省大量的重复安装、部署时间。



ISO镜像
-------
    ISO镜像使用前，需要先由界面上传到系统中。上传完成后，当启动空白云主机时，可以选择加载光盘镜像，则云主机就可以通过网络方式由光盘镜像启动安装各种操作系统，完成云主机的初始化工作。ISO镜像也适用于普通安装光盘，用户可以将普通安装光盘制作为系统中的ISO镜像，然后在云主机运行中，实时加载并安装，使用效果与传统物理服务器插入光盘安装软件完全相同。
    
    ..  image:: images/13_1_iso_image.png
        
    

主机镜像
--------
    主机镜像是为了批量快速部署云主机而设计的。传统服务器部署时，需要为每台服务器重新安装操作系统、部署必要软件，使用云管理平台可以大幅度节约部署时间，提高部署效率。用户可以先在一台云主机上，安装好操作系统和需要部署的应用软件，然后选择以该云主机为模板制作主机镜像，一键点击，云管理平台就会将该云主机的磁盘文件制作为主机镜像，保管在镜像服务器上。
    
    主机镜像生成后，用户在部署新云主机时，可以选择从主机镜像创建，则云管理平台会将主机镜像克隆为新云主机的磁盘文件，则云主机启动后，就会拥有与模板云主机相同的操作系统和应用软件，无需再重新安装。
    
    工作流程如下图所示：
    
    ..  image:: images/13_2_disk_image.png


存储模式
========

致云云管理平台目前提供两种存储模式选择， *本地存储* 和 *共享存储* 。云管理平台默认工作在本地存储模式下，当平台接入了共享存储系统后，需要将计算资源池、*Storage Server* 等设置为共享存储模式。


    **本地存储**    
        在本地存储模式下，云主机磁盘文件、ISO镜像、主机镜像均保存在服务器节点的本地磁盘中，镜像的传输、控制通过致云内部协议完成。

    **共享存储**
        在共享存储模式下，云主机磁盘文件、ISO镜像、主机镜像均保存在共享存储系统中，镜像数据复制在共享存储系统内部进行，云平台仅进行控制管理。
        
    两种模式对比如下：
    
    ..  image:: images/14_storage_mode.png


    关于平台存储模式的设置，请注意以下几点：
    
    1.  云主机的存储模式，是由所属资源池的存储模式所决定的，云主机直接继承资源池的存储模式，不需要也不允许单独指定存储模式
    
    #.  *Storage Server* 存储模式必须与计算资源池的存储模式相同，才能正常工作
    
    #.  只有计算资源池内无任何云主机时，才允许修改计算资源池存储模式


